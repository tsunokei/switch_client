<!DOCTYPE html>
<html lang = "ja">
<head>
	<meta charset = "UTF-8">
	<meta name = "viewport" content = "width=device-width, height=device-height,initial-scale=1,maximum-scale=1 ,user-scalable = no">
	<!-- <meta http-equiv = "refresh" content = " 10; URL = home.html"> -->
	<script src = "components/loader.js"></script>
	<script src = "components/jquery.cookie.js"></script>	
	<link rel = "stylesheet" href = "components/loader.css">
	<link rel = "stylesheet" href = "css/style.css">
	<link rel = "stylesheet" href = "css/nav.css">
	<link rel = "stylesheet" href = "css/main-content.css">
	<link rel = "stylesheet" href = "css/helper.css">
	<script type="text/JavaScript">
	</script>
</head>
<body>
	<div class = "image-back">
		<div class = "lording-image">
			<img src = "lording.gif">
		</div>
		<h1>読み込み中です...</h1>
	</div>
	<div class = "form">
		<p>
			名前:<input type ="text" id="name" name ="name" size ="40">
		</p>
			<p id="submit">送信</p>
		<p>名前:<input type = "text" id="get" name ="get" size ="40">
		</p>
			<p id="receive">受信</p>
	</div>
	<script>

		$(function(){
			$("#submit").on("click",function(){
				username = $("#name").val();
				$("#name").val("");
				$.ajax({
					url:"http://95d6ccd0.ngrok.io/api/v1/auth/token.json",
					type:"GET",
					success: function(msg){
						window.hoge = msg;
						localStorage.setItem("auth_token",msg["response"]["auth_token"]);
					},
					error: function(){
						alert("no name!!!");
					}
				});
			});
			$("#receive").on("click",function(){
				var cauth_token = localStorage.getItem("auth_token");
				console.log(cauth_token);
				$("#get").val(cauth_token);
			});

			getCookie = function(c_name){
				var st="";
				var ed="";
				if(document.cookie.length>0){
					// クッキーの値を取り出す
					st=document.cookie.indexOf(c_name + "=");
					if(st!=-1){ 
						st=st+c_name.length+1;
						ed=document.cookie.indexOf(";",st);
						if(ed==-1) ed=document.cookie.length;
						// 値をデコードして返す
						console.log("kita")						
						return unescape(document.cookie.substring(st,ed));
					} 
				}
				console.log("kitanai")										
				return "";
			}

			setCookie = function(c_name,value,expiredays){
				var path = location.pathname;
				// pathをフォルダ毎に指定する場合のIE対策
				var paths = new Array();
				paths = path.split("/");
				if(paths[paths.length-1] != ""){
					paths[paths.length-1] = "";
					path = paths.join("/");
				}
				// 有効期限の日付
				var extime = new Date().getTime();
				var cltime = new Date(extime + (60*60*24*1000*expiredays));
				var exdate = cltime.toUTCString();
				// クッキーに保存する文字列を生成
				var s="";
				s += c_name +"="+ escape(value);// 値はエンコードしておく
				s += "; path="+ path;
				if(expiredays){
					s += "; expires=" +exdate+"; ";
				}else{
					s += "; ";
				}
				console.log(s)
				// クッキーに保存
				document.cookie=s;
			}
			checkCookie = function(){
				if(getCookie('auth_token')){
					var setName = getCookie('auth_token');
					// alert(setName);
				}
			}
			visitorNameWrite = function(){
				var wrtName = document.getElementById('name').value;
				$.cookie("auth_token",wrtName);
				// setCookie('vsName',wrtName,30);
				// visitorName();
			}
		});
		

		//$(function(){

			//$("#submit").on("click", function(){//idがsubmitのものについて、clickしたときに対するfunction
			//	username = $("#name").val();//idがnameであるもののvalueをusernameに格納する			
			//	$("#name").val("");//usernameに格納したら、フォームの中身を空っぽにする
			//	$.ajax({
			//		url: "https://api.github.com/users/" + username + "/repos",
			//		type: "GET",
			//		success: function(msg){//githubのリポジトリからとってきたものをhogeに格納
			//	        window.hoge = msg;
			//		},
			//		error: function(){
			//			alert("no name!");
			//		}
			//	});
			//	var element = $('#frm [name=name]').val();
			//});
		//});ここまで


			// $.ajax({
			// 	url: "https://api.github.com/users/gamerinshaft/repos",
			// 	type: "GET",
			// 	success: function(msg){
			//         window.hoge = msg;
			// 	}
			// var element = $('#frm [name=name]').val();

			// console.log("element");
			//  })
			// console.log("hello,world");

	</script>
</body>
</html>